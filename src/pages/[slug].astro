---
import BaseLayout from '../layouts/BaseLayout.astro';
import PageContent from '../components/PageContent.astro';
import { directusItemsUrl } from '../lib/directus';

type Page = {
	status?: string;
	slug?: string;
	title?: string;
	Titolo?: string;
	seo_title?: string;
	seo_desc?: string;
	hide_page_header?: boolean;
	page_header?: string;
	editor?: unknown[];
};

export async function getStaticPaths() {
	const url = directusItemsUrl('pages');
	url.searchParams.set(
		'fields',
		'*,editor.item.*,editor.item.slider.*,editor.item.slider.slides.item.*,editor.item.card.single_card_id.*,editor.item.card.single_card_id.link.id,editor.item.card.single_card_id.link.slug,editor.item.card.single_card_id.link.title'
	);
	const response = await fetch(url);
	const data = await response.json();
	const pages = data?.data ?? [];
	const publishedPages = pages.filter(
		(page: Page) => page.status === 'published' && page.slug
	);

	return publishedPages
		.filter((page: Page) => page.slug !== 'home')
		.map((page: Page) => ({
			params: { slug: page.slug },
			props: { page },
		}));
}

const { page } = Astro.props;
---

<BaseLayout
	title={page?.title || page?.Titolo || 'Pagina'}
	seoTitle={page?.seo_title}
	seoDescription={page?.seo_desc}
>
	<PageContent page={page} />
</BaseLayout>
